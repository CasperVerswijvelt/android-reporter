<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Report anything</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script defer>
      fetch("/api/reports")
        .then((response) => response.json())
        .then(handleReports);

      function handleReports(reports) {
        // Visualize total unique instances in last 3 days
        document.getElementById("count").innerText = reports.total;

        const fragment = document.createDocumentFragment();
        const entries = Object.entries(reports.properties);
        const length = entries.length;
        Object.entries(reports.properties).forEach(([property, value]) => {
          const chartElement = document.createElement("canvas");
          const chart = new Chart(chartElement.getContext("2d"), {
            type: "bar",
            data: {
              labels: Object.keys(value),
              datasets: [
                {
                  label: property,
                  data: Object.values(value),
                  backgroundColor: getRandomColorArray(length, 0.5),
                },
              ],
            },
            options: {
              scales: {
                y: {
                  ticks: {
                    stepSize: 1,
                  },
                },
              },
              plugins: {
                legend: {
                  display: false,
                },
                title: {
                  display: true,
                  text: property,
                  padding: {
                    top: 10,
                    bottom: 20
                  }
                }
              },
            },
          });
          const chartContainer = document.createElement("div");
          chartContainer.setAttribute("class", "chart");
          chartContainer.appendChild(chartElement);
          fragment.appendChild(chartContainer);
        });

        document.getElementById("charts").appendChild(fragment);
      }

      function getRandomColorArray(length, opacity) {
        return Array.from({ length: length }, () => getRandomColor(opacity));
      }

      function getRandomColor(opacity = 0.5) {
        return `rgb(${randomNum()}, ${randomNum()}, ${randomNum()}, ${opacity})`;
      }

      function randomNum() {
        return Math.floor(Math.random() * (235 - 52 + 1) + 52);
      }
    </script>
    <style>
      * {
        font-family: sans-serif;
        margin: 0;
        padding: 0;
      }
      body {
        width: 100vw;
        padding: 0 30px;
        box-sizing: border-box;
        background: rgb(235 235 235);
        overflow-x: hidden;
      }
      #charts {
        display: grid;
        grid-template-columns: 1fr;
        gap: 25px;
        padding: 15px;
        box-sizing: border-box;
      }
      .chart {
        min-height: 40px;
        box-sizing: border-box;
        background-color: rgb(255, 255, 255);
        border-radius: 15px;
        box-shadow: 0px 0px 10px rgb(0 0 0 / 10%);
        overflow: hidden;
        padding: 10px;
      }
      .title {
        color: rgb(44, 44, 44);
        text-align: center;
        padding: 15px 20px;
      }
      @media (min-width: 700px) {
        body {
          margin: 0 auto;
          max-width: 900px;
        }
        #charts {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <h1 class="title">Total: <span id="count">...</span></h1>
    <div id="charts"></div>
  </body>
</html>
